# history-learnings

Service analytics dashboard - cross-references Jira tickets against the Coda Servicekatalog to surface team ownership, ticket volume trends, customer breadth, and cross-service dependencies.

## Tech Stack

| Layer | Choice |
|-------|--------|
| Framework | React 19 + Vite 7 |
| Charts | Recharts 3 |
| Icons | Lucide React |
| State | useState / useMemo (no Redux) |
| Routing | Hash-based (`window.location.hash`) |
| Styling | Inline styles via `theme.js` (no CSS framework) |
| Data | Static `public/data.json` + `public/profiles2025.json` fetched on mount |

## File Structure

```
history-learnings/
├── public/
│   ├── data.json              # Generated - Jira x Coda join (DO NOT edit manually)
│   └── profiles2025.json      # Generated - staff profiles for ERP 2025 view
├── scripts/
│   └── generate_data.py       # Python script to regenerate public/data.json
├── src/
│   ├── App.jsx                # Root - sidebar nav, hash routing, data fetch
│   ├── config/
│   │   └── theme.js           # Single source of truth for all colors/styles
│   └── views/
│       ├── ServiceDashboard.jsx   # Grid of all services with filters
│       ├── ServiceDetail.jsx      # Single service drill-down with Recharts
│       ├── TeamView.jsx           # Person-centric view, ticket assignments
│       ├── TrendView.jsx          # Yearly ticket trends across services
│       ├── CategoryView.jsx       # Services grouped by Servicekategorie
│       ├── CustomerView.jsx       # Customer breadth per service
│       ├── ProjectView.jsx        # Project-level ticket breakdown
│       ├── UnitView.jsx           # Services grouped by business unit
│       ├── ERP2025View.jsx        # Staff profiles + ERP migration context
│       ├── CrossReferencesView.jsx# Service co-occurrence, team overlap, dependencies
│       ├── UnmatchedView.jsx      # Jira tickets with no service match
│       └── MethodikView.jsx       # Methodology / how data was built
```

## Views / Routes

| Hash | Component | Description |
|------|-----------|-------------|
| `#services` | ServiceDashboard | Default view - filterable service grid |
| `#service-{name}` | ServiceDetail | Drill-down for one service |
| `#cross-refs` | CrossReferencesView | 6-tab cross-reference analysis |
| `#team` | TeamView | Per-person ticket stats |
| `#trends` | TrendView | Yearly trends, top-10 services |
| `#categories` | CategoryView | Grouped by Servicekategorie |
| `#customers` | CustomerView | Customer breadth per service |
| `#projects` | ProjectView | Project-level breakdown |
| `#units` | UnitView | Grouped by business unit |
| `#erp-2025` | ERP2025View | Requires profiles2025.json |
| `#unmatched` | UnmatchedView | Tickets without service match |
| `#methodik` | MethodikView | Data methodology explanation |

## Data Model (public/data.json)

Generated by `scripts/generate_data.py` from four sources:

- **Jira export** `_System/_Data/jira_export_2026-02-25.json` (53,737 tickets)
- **Coda Services CSV** `_Rohdaten/Coda/2026-01-25/Services Übersicht.csv` (58 services)
- **Coda Sales CSV** `_Rohdaten/Coda/2026-01-25/Sales Übersicht.csv`
- **Coda Staff / Units CSVs**

Key top-level fields:

```js
{
  meta: { totalTickets, matchedTickets, matchRate, servicesWithMatches, totalStaff, activeUnits },
  services: [{ name, status, type, kategorie, unit, owner, tickets, yearlyTickets, topAssignees }],
  yearlyTrend: { "2020": { total }, ... },
  crossReferences: { stats, cooccurrence, temporal, teamOverlap, ... }
}
```

Service status values: `Live | Entwicklung | Maintenance / EoS | GTM Ready | Idea | Verworfen | These | Template`

## Key Components

- **App.jsx** owns all state: `data`, `currentView`, `selectedService`, `selectedPerson`, `profiles`
- Navigation via `navigate(id)` (sets hash + state) and `openService(name)` / `openPerson(name)`
- `theme.js` exports a single `theme` object - all inline styles reference it, never hardcode hex values
- `ServiceDashboard` uses `useMemo` for filter + sort - keep expensive derivations memoized
- `CrossReferencesView` has internal tab state for its 6 sub-views

## Regenerating Data

```bash
cd _Apps/second-brain-project/history-learnings
python scripts/generate_data.py
# Output: public/data.json
```

Requires Jira export at `_System/_Data/jira_export_2026-02-25.json` and Coda CSVs at `_Rohdaten/Coda/2026-01-25/`.

## Dev Commands

```bash
npm run dev      # Vite dev server (localhost:5173)
npm run build    # Production build
npm run preview  # Preview production build
```

## Constitution Rules

1. **Never edit public/data.json manually** - always regenerate via `generate_data.py`
2. **All colors from theme.js** - no hardcoded hex values in components
3. **No routing library** - hash-based navigation only, keep it simple
4. **No Redux** - local useState + useMemo is sufficient for this read-only dashboard
5. **No TypeScript** - plain JSX, keep the feedback loop fast

## Anti-Patterns

| Anti-Pattern | Why | Instead |
|---|---|---|
| Editing data.json by hand | Will be overwritten by generate_data.py | Fix the Python script |
| Adding colors inline | Breaks dark theme consistency | Use `theme.semantic.*` or `theme.status.*` |
| Fetching data in views | Data is fetched once in App.jsx and passed as props | Use props |
| Using `window.location.pathname` for routing | App uses hash routing | Use `window.location.hash` |
| Multiple data fetches on mount | Causes flicker | Add to App.jsx useEffect, pass as prop |

## Related Projects

| Project | Path | Relation |
|---------|------|----------|
| business-planning/frontend | `_Apps/second-brain-project/business-planning/frontend` | References history data via `historyClient.js`; shares service analytics domain |
| meeting-memory | `_Apps/second-brain-project/meeting-memory` | Source of meeting context; different data pipeline |
| Power BI Dashboard | levigo-bi.vercel.app | Revenue mapping linked from ServiceDetail (PBI Mapping button) |
| Coda Servicekatalog | External (Coda) | Source for service metadata (status, type, unit, owner) |
